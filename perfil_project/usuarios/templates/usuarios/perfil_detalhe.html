{% extends 'usuarios/base.html' %}
{% block content %}

<h2>Ol√°, {{ perfil.nome }}</h2>

<ul>
  <li><strong>Sexo:</strong> {{ perfil.get_sexo_display }}</li>
  <li><strong>Idade:</strong> {{ perfil.idade }}</li>
  <li><strong>Altura:</strong> {{ perfil.altura }} m</li>
  <li><strong>Peso:</strong> {{ perfil.peso }} kg</li>
</ul>


<div style="max-width: 600px; height: 300px; margin: auto;">
  <canvas id="graficoPeso">
    
    <h3>üìà Evolu√ß√£o Corporal</h3>
    <div style="max-width: 700px; height: 350px; margin: auto;">
      <canvas id="graficoPeso"></canvas>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById('graficoPeso').getContext('2d');
      const graficoPeso = new Chart(ctx, {
        type: 'line',
        data: {
          labels: {{ datas|safe }},
          datasets: [
            {
              label: 'Peso (kg)',
              data: {{ pesos|safe }},
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              tension: 0.3,
              fill: false,
            },
            {
              label: 'IMC',
              data: {{ imcs|safe }},
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              tension: 0.3,
              fill: false,
            },
            {
              label: 'Gordura (%)',
              data: {{ gorduras|safe }},
              borderColor: 'rgba(255, 206, 86, 1)',
              backgroundColor: 'rgba(255, 206, 86, 0.2)',
              tension: 0.3,
              fill: false,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    </script>

  </canvas>
</div>

<h3>Resultados:</h3>
<ul>
  <li><strong>IMC:</strong> <span style="color: {{ perfil.imc_cor }}">{{ perfil.imc }} - {{ perfil.imc_classificacao }}</span></li>
  <li><strong>TMB:</strong> {{ perfil.tmb }} kcal/dia</li>
  <li><strong>Calorias para manter:</strong> {{ perfil.calorias_para_manter }} kcal</li>
  <li><strong>Prote√≠na di√°ria:</strong> {{ perfil.proteina_diaria }} g</li>
</ul>

<li>
    <strong>Prote√≠na di√°ria recomendada:</strong> {{ perfil.proteina_diaria }} g
    <br>
    <small style="color: gray;">
      Baseado no seu n√≠vel de atividade 
      <strong>"{{ perfil.get_nivel_atividade_display }}"</strong>, este valor foi estimado automaticamente.
    </small>
</li>

<hr>
<p><a href="{% url 'atualizar_peso' perfil.pk %}">üì• Atualizar Peso</a></p>
<p><a href="{% url 'calcular_meta' perfil.pk %}">üéØ Definir Meta</a></p>
<p><a href="{% url 'criar_perfil' %}">‚ûï Criar Novo Perfil</a></p>
<p><a href="/admin/usuarios/perfil/">‚öôÔ∏è Perfil admin (admin)</a></p>

<form action="{% url 'excluir_perfil' perfil.pk %}" method="post">
  {% csrf_token %}
  <button style="background:red;color:white;" onclick="return confirm('Tem certeza que deseja excluir este perfil?')">
    ‚ùå Excluir Perfil
  </button>
</form>

{% endblock %}